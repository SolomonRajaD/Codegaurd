<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeGuard Project Portal</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
        background-color: #000;
        color: #e2e8f0;
    }
    .animated-gradient-text {
        background: linear-gradient(90deg, #38bdf8, #818cf8, #c084fc, #e879f9, #38bdf8);
        background-size: 200% auto;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradient-flow 5s linear infinite;
    }
    @keyframes gradient-flow {
        0% { background-position: 0% 50%; }
        100% { background-position: 200% 50%; }
    }
    .grid-pattern {
        background-image: linear-gradient(rgba(255, 255, 255, 0.07) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.07) 1px, transparent 1px);
        background-size: 3rem 3rem;
    }
    .hero-gradient {
        background-color: #000;
        background-image: radial-gradient(at 27% 37%, hsla(215, 98%, 61%, 0.1) 0px, transparent 50%), radial-gradient(at 77% 82%, hsla(285, 88%, 63%, 0.1) 0px, transparent 50%);
    }
     @keyframes fade-in {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
        animation: fade-in 0.5s ease-out forwards;
    }
</style>
</head>
<body class="bg-black">
<div id="root"></div>

<!-- React & Babel for in-browser JSX transformation -->
<script src="[https://unpkg.com/react@18/umd/react.development.js](https://unpkg.com/react@18/umd/react.development.js)"></script>
<script src="[https://unpkg.com/react-dom@18/umd/react-dom.development.js](https://unpkg.com/react-dom@18/umd/react-dom.development.js)"></script>
<script src="[https://unpkg.com/@babel/standalone/babel.min.js](https://unpkg.com/@babel/standalone/babel.min.js)"></script>

<!-- Lucide Icons -->
<script src="[https://unpkg.com/lucide@latest](https://unpkg.com/lucide@latest)"></script>

<!-- Firebase SDKs (v9 Compat libraries for this setup) -->
<script src="[https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js](https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js)"></script>
<script src="[https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js](https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js)"></script>
<script src="[https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js](https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js)"></script>
<script src="[https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js](https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js)"></script>

<script type="text/babel" data-presets="react">
    const { useState, useEffect, useCallback } = React;
    
    // --- Firebase Configuration from your screenshot ---
    const firebaseConfig = {
        apiKey: "AIzaSyCVl-Fc_XXUwGNJK_nwKFv40VNJ_w4wE",
        authDomain: "codeguard-c7aac.firebaseapp.com",
        projectId: "codeguard-c7aac",
        storageBucket: "codeguard-c7aac.appspot.com",
        messagingSenderId: "926315577625",
        appId: "1:926315577625:web:c536204d5c6113e00e588",
        measurementId: "G-KET6TSBL8E"
    };
    // --- END OF FIREBASE CONFIG ---

    // Initialize Firebase using the v8 namespaced syntax
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();
    const provider = new firebase.auth.GoogleAuthProvider();

    // --- Icon Component ---
    // A helper component to render Lucide icons correctly
    const Icon = ({ name, ...props }) => {
        useEffect(() => {
            lucide.createIcons();
        }, []);
        return <i data-lucide={name} {...props}></i>;
    };

    // --- Main App Component ---
    function App() {
        const [user, setUser] = useState(null);
        const [userData, setUserData] = useState(null);
        const [page, setPage] = useState('login'); // login, admin, employee, customer
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState('');

        useEffect(() => {
            const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
                if (currentUser) {
                    const userDocRef = db.collection('users').doc(currentUser.uid);
                    const userDocSnap = await userDocRef.get();
                    
                    if (userDocSnap.exists) {
                        const dbUserData = userDocSnap.data();
                        setUser(currentUser);
                        setUserData(dbUserData);
                        setPage(dbUserData.role);
                    } else {
                        // New customer logging in with Google
                        const newUserData = {
                            email: currentUser.email,
                            name: currentUser.displayName,
                            role: 'customer',
                            createdAt: firebase.firestore.Timestamp.now()
                        };
                        await userDocRef.set(newUserData);
                        setUser(currentUser);
                        setUserData(newUserData);
                        setPage('customer');
                    }
                } else {
                    setUser(null);
                    setUserData(null);
                    setPage('login');
                }
                setLoading(false);
            });
            return () => unsubscribe();
        }, []);

        const handleGoogleLogin = async () => {
            try {
                await auth.signInWithPopup(provider);
            } catch (error) {
                console.error("Google login error:", error);
                setError("Could not log in with Google. Please try again.");
            }
        };
        
        const handleEmployeeLogin = async (email, password) => {
            setError('');
            if (!email || !password) {
                setError('Please enter email and password.');
                return;
            }
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                setError('Invalid credentials. Please check your email and password.');
            }
        };

        const handleLogout = async () => {
            await auth.signOut();
        };

        const renderPage = () => {
            if (loading) {
                return <LoadingScreen />;
            }

            switch (page) {
                case 'admin':
                    return <AdminDashboard user={user} userData={userData} onLogout={handleLogout} />;
                case 'employee':
                    return <EmployeeDashboard user={user} userData={userData} onLogout={handleLogout} />;
                case 'customer':
                    return <CustomerDashboard user={user} userData={userData} onLogout={handleLogout} />;
                default:
                    return <LoginPage onGoogleLogin={handleGoogleLogin} onEmployeeLogin={handleEmployeeLogin} error={error} />;
            }
        };

        return (
            <div className="bg-black min-h-screen text-slate-200 antialiased">
                {renderPage()}
            </div>
        );
    }

    const LoadingScreen = () => (
        <div className="flex items-center justify-center min-h-screen">
            <div className="flex flex-col items-center gap-4">
                <div className="w-16 h-16 border-4 border-sky-400 border-t-transparent rounded-full animate-spin"></div>
                <p className="text-lg text-slate-400">Loading Secure Portal...</p>
            </div>
        </div>
    );

    const LoginPage = ({ onGoogleLogin, onEmployeeLogin, error }) => {
        const [loginType, setLoginType] = useState('customer');
        const [email, setEmail] = useState('');
        const [password, setPassword] = useState('');
        
        const handleSubmit = (e) => {
            e.preventDefault();
            onEmployeeLogin(email, password);
        };

        const LoginCard = ({ title, children, active, onClick }) => (
            <div 
                onClick={onClick}
                className={`w-full md:w-80 p-8 border rounded-2xl transition-all duration-300 cursor-pointer ${
                    active ? 'bg-slate-900 border-sky-500 shadow-2xl shadow-sky-500/20' : 'bg-slate-900/50 border-slate-800 hover:border-slate-600'
                }`}
            >
                <h3 className="text-2xl font-bold text-center text-white mb-6">{title}</h3>
                {children}
            </div>
        );

        return (
            <div className="min-h-screen flex flex-col items-center justify-center p-4 relative overflow-hidden hero-gradient">
                <div className="absolute inset-0 grid-pattern opacity-20"></div>
                <div className="relative z-10 text-center mb-12">
                    <h1 className="text-5xl md:text-7xl font-black tracking-tighter text-white mb-4">
                        Welcome to <span className="animated-gradient-text">Code</span>Guard
                    </h1>
                    <p className="text-lg text-slate-400 max-w-2xl">The unified portal for our clients and team. Secure, transparent, and efficient project delivery.</p>
                </div>
                <div className="relative z-10 flex flex-col md:flex-row gap-8">
                    <LoginCard title="Client Portal" active={loginType === 'customer'} onClick={() => setLoginType('customer')}>
                        {loginType === 'customer' && (
                            <div className="flex flex-col items-center animate-fade-in">
                                <p className="text-slate-400 text-center mb-6">Access your project dashboard, track progress, and download deliverables.</p>
                                <button onClick={onGoogleLogin} className="w-full flex items-center justify-center gap-3 bg-white text-slate-800 font-semibold py-3 px-6 rounded-lg hover:bg-slate-200 transition-colors">
                                    <svg className="w-6 h-6" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35,11.1H12.18V13.83H18.69C18.36,17.64 15.19,19.27 12.19,19.27C8.36,19.27 5,16.25 5,12.5C5,8.75 8.36,5.73 12.19,5.73C14.03,5.73 15.6,6.36 16.84,7.48L19.09,5.23C17.11,3.46 14.8,2.5 12.19,2.5C6.92,2.5 3,6.58 3,12.5C3,18.42 6.92,22.5 12.19,22.5C17.6,22.5 21.6,18.61 21.6,12.71C21.6,12.06 21.51,11.58 21.35,11.1Z"></path></svg>
                                    Sign In with Google
                                </button>
                            </div>
                        )}
                    </LoginCard>
                    <LoginCard title="Team Portal" active={loginType === 'employee'} onClick={() => setLoginType('employee')}>
                        {loginType === 'employee' && (
                            <form onSubmit={handleSubmit} className="flex flex-col gap-4 animate-fade-in">
                                <input
                                    type="email"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    placeholder="Email"
                                    className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500"
                                />
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Password"
                                    className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500"
                                />
                                <button type="submit" className="w-full bg-sky-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-600 transition-colors">
                                    Login
                                </button>
                                {error && <p className="text-red-400 text-sm text-center mt-2">{error}</p>}
                            </form>
                        )}
                    </LoginCard>
                </div>
            </div>
        );
    };

    const DashboardLayout = ({ children, title, userData, onLogout }) => {
        useEffect(() => {
            lucide.createIcons();
        });

        return (
            <div className="flex flex-col min-h-screen">
                <header className="bg-slate-900/50 backdrop-blur-lg border-b border-slate-800 sticky top-0 z-40">
                    <div className="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
                        <h1 className="text-xl font-bold text-white tracking-tight">{title}</h1>
                        <div className="flex items-center gap-4">
                            <span className="text-slate-400 text-sm hidden sm:block">Welcome, {userData?.name}</span>
                            <button onClick={onLogout} className="text-slate-400 hover:text-white transition-colors text-sm font-semibold">Logout</button>
                        </div>
                    </div>
                </header>
                <main className="flex-grow container mx-auto p-4 sm:p-6 lg:p-8">
                    {children}
                </main>
            </div>
        )
    };

    const AdminDashboard = ({ user, userData, onLogout }) => {
        const [projects, setProjects] = useState([]);
        const [users, setUsers] = useState([]);

        useEffect(() => {
            const unsubscribeProjects = db.collection('projects').onSnapshot((snapshot) => {
                const projectsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setProjects(projectsData);
            });

            const unsubscribeUsers = db.collection('users').onSnapshot((snapshot) => {
                const usersData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setUsers(usersData);
            });

            return () => {
                unsubscribeProjects();
                unsubscribeUsers();
            };
        }, []);

        const approveProject = async (projectId) => {
            const projectRef = db.collection('projects').doc(projectId);
            await projectRef.update({ status: 'in-progress' });
        };
        
        const getCustomerName = (customerId) => {
            const customer = users.find(u => u.id === customerId);
            return customer ? customer.name : 'Unknown';
        };

        return (
            <DashboardLayout title="Admin Dashboard" userData={userData} onLogout={onLogout}>
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div className="bg-slate-900 p-6 rounded-lg border border-slate-800">
                        <h3 className="text-slate-400 text-sm font-medium">Total Projects</h3>
                        <p className="text-3xl font-bold text-white mt-1">{projects.length}</p>
                    </div>
                     <div className="bg-slate-900 p-6 rounded-lg border border-slate-800">
                        <h3 className="text-slate-400 text-sm font-medium">Projects In Progress</h3>
                        <p className="text-3xl font-bold text-white mt-1">{projects.filter(p => p.status === 'in-progress').length}</p>
                    </div>
                     <div className="bg-slate-900 p-6 rounded-lg border border-slate-800">
                        <h3 className="text-slate-400 text-sm font-medium">Pending Approval</h3>
                        <p className="text-3xl font-bold text-yellow-400 mt-1">{projects.filter(p => p.status === 'pending').length}</p>
                    </div>
                </div>
                
                <h2 className="text-2xl font-bold mb-4">Project Overview</h2>
                <div className="bg-slate-900 border border-slate-800 rounded-lg overflow-hidden">
                    <div className="divide-y divide-slate-800">
                        {projects.map(project => (
                            <div key={project.id} className="p-4">
                                <div className="flex justify-between items-center">
                                    <div>
                                        <h4 className="font-bold text-lg text-white">{project.name}</h4>
                                        <p className="text-sm text-slate-400">Customer: {getCustomerName(project.customerId)}</p>
                                    </div>
                                    <div className="flex items-center gap-4">
                                         <span className={`text-xs font-semibold px-2.5 py-1 rounded-full ${
                                             project.status === 'completed' ? 'bg-emerald-900 text-emerald-300' :
                                             project.status === 'in-progress' ? 'bg-sky-900 text-sky-300' :
                                             'bg-yellow-900 text-yellow-300'
                                         }`}>{project.status}</span>
                                        {project.status === 'pending' && (
                                            <button onClick={() => approveProject(project.id)} className="bg-emerald-500 text-white text-xs font-bold py-1 px-3 rounded hover:bg-emerald-600 transition-colors">Approve</button>
                                        )}
                                    </div>
                                </div>
                                 <div className="mt-4">
                                    <p className="text-slate-500 text-xs mb-1">Progress</p>
                                    <div className="w-full bg-slate-700 rounded-full h-2.5">
                                        <div className="bg-sky-500 h-2.5 rounded-full" style={{width: `${project.progress || 0}%`}}></div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </DashboardLayout>
        );
    };

    const EmployeeDashboard = ({ user, userData, onLogout }) => {
        const [myProjects, setMyProjects] = useState([]);

        useEffect(() => {
            if(!user) return;
            const q = db.collection('projects').where('assignedEmployees', 'array-contains', user.uid);
            const unsubscribe = q.onSnapshot((snapshot) => {
                const projectsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setMyProjects(projectsData);
            });
            return () => unsubscribe();
        }, [user]);
        
        const updateProgress = async (projectId, newProgress) => {
            const projectRef = db.collection('projects').doc(projectId);
            await projectRef.update({ progress: Number(newProgress) });
        };

        return (
            <DashboardLayout title="My Projects" userData={userData} onLogout={onLogout}>
                {myProjects.length > 0 ? (
                    <div className="space-y-6">
                        {myProjects.map(project => (
                            <div key={project.id} className="bg-slate-900 p-6 rounded-lg border border-slate-800">
                                <h3 className="text-xl font-bold text-white mb-2">{project.name}</h3>
                                <p className="text-slate-400 mb-4">{project.description}</p>
                                <div className="flex items-center gap-4">
                                    <label htmlFor={`progress-${project.id}`} className="text-sm font-medium text-slate-400">Progress: {project.progress || 0}%</label>
                                    <input 
                                        type="range" 
                                        id={`progress-${project.id}`}
                                        min="0" 
                                        max="100" 
                                        defaultValue={project.progress || 0}
                                        onChange={(e) => updateProgress(project.id, e.target.value)}
                                        className="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer" 
                                    />
                                </div>
                            </div>
                        ))}
                    </div>
                ) : (
                    <div className="text-center py-16">
                        <Icon name="briefcase" className="mx-auto h-12 w-12 text-slate-500" />
                        <h3 className="mt-2 text-xl font-semibold text-white">No Assigned Projects</h3>
                        <p className="mt-1 text-slate-400">You currently have no projects assigned to you.</p>
                    </div>
                )}
            </DashboardLayout>
        );
    };

    const CustomerDashboard = ({ user, userData, onLogout }) => {
        const [projects, setProjects] = useState([]);
        const [newProjectName, setNewProjectName] = useState('');
        const [newProjectDesc, setNewProjectDesc] = useState('');

        useEffect(() => {
            if(!user) return;
            const q = db.collection('projects').where('customerId', '==', user.uid);
            const unsubscribe = q.onSnapshot((snapshot) => {
                const projectsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                setProjects(projectsData);
            });
            return () => unsubscribe();
        }, [user]);

        const handleCreateProject = async (e) => {
            e.preventDefault();
            if (!newProjectName.trim()) return;
            await db.collection('projects').add({
                name: newProjectName,
                description: newProjectDesc,
                customerId: user.uid,
                status: 'pending',
                progress: 0,
                createdAt: firebase.firestore.Timestamp.now(),
                assignedEmployees: []
            });
            setNewProjectName('');
            setNewProjectDesc('');
        };

        return (
            <DashboardLayout title="My Dashboard" userData={userData} onLogout={onLogout}>
                <div className="bg-slate-900 border border-slate-800 rounded-lg p-6 mb-8">
                    <h2 className="text-2xl font-bold text-white mb-4">Start a New Project</h2>
                    <form onSubmit={handleCreateProject} className="space-y-4">
                         <input
                            type="text"
                            value={newProjectName}
                            onChange={(e) => setNewProjectName(e.target.value)}
                            placeholder="Project Name (e.g., New E-commerce Website)"
                            className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500"
                        />
                        <textarea
                            value={newProjectDesc}
                            onChange={(e) => setNewProjectDesc(e.target.value)}
                            placeholder="Briefly describe your project requirements..."
                            rows="3"
                            className="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:ring-2 focus:ring-sky-500"
                        ></textarea>
                        <button type="submit" className="inline-flex items-center gap-2 bg-sky-500 text-white font-bold py-2 px-5 rounded-lg hover:bg-sky-600 transition-colors">
                            <Icon name="plus-circle" size={20} /> Request Project
                        </button>
                    </form>
                </div>
                
                <h2 className="text-2xl font-bold mb-4">My Projects</h2>
                 {projects.length > 0 ? (
                    <div className="space-y-4">
                        {projects.map(project => (
                            <div key={project.id} className="bg-slate-900 p-4 rounded-lg border border-slate-800">
                                <div className="flex justify-between items-start">
                                    <div>
                                        <h4 className="font-bold text-lg text-white">{project.name}</h4>
                                        <p className="text-sm text-slate-400 max-w-lg">{project.description}</p>
                                    </div>
                                    <span className={`text-xs font-semibold px-2.5 py-1 rounded-full ${
                                        project.status === 'completed' ? 'bg-emerald-900 text-emerald-300' :
                                        project.status === 'in-progress' ? 'bg-sky-900 text-sky-300' :
                                        'bg-yellow-900 text-yellow-300'
                                    }`}>{project.status}</span>
                                </div>
                                <div className="mt-4">
                                    <div className="flex justify-between items-center text-sm text-slate-400 mb-1">
                                        <span>Progress</span>
                                        <span>{project.progress || 0}%</span>
                                    </div>
                                    <div className="w-full bg-slate-700 rounded-full h-2.5">
                                        <div className="bg-emerald-500 h-2.5 rounded-full" style={{width: `${project.progress || 0}%`}}></div>
                                    </div>
                                </div>
                                {project.status === 'completed' && project.fileUrl && (
                                    <a href={project.fileUrl} target="_blank" rel="noopener noreferrer" className="mt-4 inline-flex items-center gap-2 text-sm font-semibold text-sky-400 hover:text-sky-300">
                                        <Icon name="download" size={16} /> Download Final Project
                                    </a>
                                )}
                            </div>
                        ))}
                    </div>
                 ) : (
                    <div className="text-center py-16 border-2 border-dashed border-slate-800 rounded-lg">
                        <Icon name="briefcase" className="mx-auto h-12 w-12 text-slate-500" />
                        <h3 className="mt-2 text-xl font-semibold text-white">No Projects Yet</h3>
                        <p className="mt-1 text-slate-400">Use the form above to create your first project.</p>
                    </div>
                 )}
            </DashboardLayout>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

</script>
</body>
</html>
